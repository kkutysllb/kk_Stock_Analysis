# 项目部署操作说明

## 一、后端环境依赖安装

1. 创建并激活 conda 虚拟环境（如已存在可跳过）
   ```bash
   conda create -n kk_stock python=3.11
   conda activate kk_stock
   ```

2. 安装后端依赖
   ```bash
   pip install -r requirements.txt
   # 如需短信功能
   pip install tencentcloud-sdk-python
   # 如需微信登录
   pip install requests
   ```

3. 配置环境变量（.env）
   - 复制 `.env.example` 为 `.env`，并填写如下内容（实际值请在各平台获取）：
     ```
     # MongoDB
     MONGO_URI=...
     DB_NAME=...

     # JWT
     JWT_SECRET_KEY=...

     # 腾讯云短信
     TENCENT_SECRET_ID=...
     TENCENT_SECRET_KEY=...
     TENCENT_SMS_APPID=...
     TENCENT_SIGN_NAME=...
     TENCENT_TEMPLATE_ID=...

     # 微信小程序
     WECHAT_APPID=...
     WECHAT_SECRET=...
     ```

---

## 二、前端环境依赖安装

1. 进入前端目录
   ```bash
   cd frontend/kk-stock-app
   ```

2. 安装依赖
   ```bash
   npm install
   ```

3. 启动开发环境（支持热重载）
   ```bash
   # H5
   ../run_frontend.sh h5
   # 微信小程序
   ../run_frontend.sh mp-weixin
   # App/Electron
   ../run_frontend.sh app
   ```

---

## 三、认证信息获取办法

### 1. 腾讯云短信
- 登录 [腾讯云短信控制台](https://console.cloud.tencent.com/smsv2)
- 获取 SecretId、SecretKey（访问管理-API密钥管理）
- 申请短信签名、模板，获取 AppID、SignName、TemplateID

### 2. 微信小程序
- 登录 [微信公众平台](https://mp.weixin.qq.com/)
- 进入小程序后台，开发-开发设置，获取 AppID 和 AppSecret

---

## 四、敏感文件忽略

请确保 `.gitignore` 包含如下内容，防止敏感信息上传：

```
.env
*.pyc
__pycache__/
frontend/kk-stock-app/node_modules/
frontend/kk-stock-app/dist/
```

---

## 五、代码上传到远程仓库

1. 初始化 git 仓库（如未初始化）
   ```bash
   git init
   ```

2. 添加远程仓库
   ```bash
   git remote add origin <你的远程仓库地址>
   ```

3. 添加、提交并推送代码
   ```bash
   git add .
   git commit -m "项目初始化及依赖配置"
   git push -u origin main
   ```

---

**注意：上传前请再次确认 `.env`、密钥等敏感文件未被提交！** 

---

## 六、数据自动更新定时任务配置

1. 赋予脚本可执行权限
   ```bash
   chmod +x /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/run_daily_update.sh
   chmod +x /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/run_nightly_update.sh
   ```

2. 编辑定时任务
   ```bash
   crontab -e
   ```

3. 添加如下内容（可根据实际需求调整时间）：
   ```
   0 8 * * * /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/run_daily_update.sh >> /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/daily_update.log 2>&1
   30 23 * * * /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/run_nightly_update.sh >> /home/libing/kk_Projects/kk_StockQuant_Analysis/data_collector/nightly_update.log 2>&1
   ```

- 日志输出到 `daily_update.log` 和 `nightly_update.log`，便于排查问题。
- 脚本内已自动激活 conda 环境，无需在 crontab 里额外设置。 